{{ define "admin_form_container" }}
<div id="form-container" class="mb-6" style="display: none;">
  <div class="bg-white shadow sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-base font-semibold leading-6 text-gray-900">{{ .FormTitle }}</h3>
    </div>
    <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
      {{ template "admin_form_content" . }}
    </div>
  </div>
</div>
{{ end }}

{{ define "admin_form_content" }}
<form method="post" class="space-y-4">
  {{ template "admin_form_fields" . }}
  
  {{ if .Errors }}
  <div class="rounded-md bg-red-50 p-4">
    <div class="flex">
      <div class="ml-3 flex-1 md:flex md:justify-between">
        <ul class="text-sm text-red-700">
          {{ range .Errors }}
          <li><b>{{ .Field }}</b> {{ .Message }}</li>
          {{ end }}
        </ul>
      </div>
    </div>
  </div>
  {{ end }}
  
  {{ if .Error }}
  <div class="rounded-md bg-blue-50 p-4">
    <div class="flex">
      <div class="ml-3 flex-1 md:flex md:justify-between">
        <p class="text-sm text-blue-700">{{ .Error }}</p>
      </div>
    </div>
  </div>
  {{ end }}
  
  <div class="flex justify-end space-x-3">
    <button type="button" onclick="hideForm()" class="admin-btn inline-flex items-center rounded-md bg-white text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
      Отмена
    </button>
    <button type="submit" class="admin-btn inline-flex items-center rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
      {{ .SubmitText }}
    </button>
  </div>
</form>
{{ end }}

{{ define "admin_form_fields" }}
<!-- This will be overridden by specific form templates -->
{{ end }}

{{ define "admin_color_form_container" }}
<div id="form-container" class="mb-6" style="display: none;">
  <div class="bg-white shadow sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-base font-semibold leading-6 text-gray-900">Create new color</h3>
    </div>
    <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
      <form method="post" class="space-y-4">
        {{ template "admin_color_form_fields" . }}
        
        {{ if .Errors }}
        <div class="rounded-md bg-red-50 p-4">
          <div class="flex">
            <div class="ml-3 flex-1 md:flex md:justify-between">
              <ul class="text-sm text-red-700">
                {{ range .Errors }}
                <li><b>{{ .Field }}</b> {{ .Message }}</li>
                {{ end }}
              </ul>
            </div>
          </div>
        </div>
        {{ end }}
        
        {{ if .Error }}
        <div class="rounded-md bg-blue-50 p-4">
          <div class="flex">
            <div class="ml-3 flex-1 md:flex md:justify-between">
              <p class="text-sm text-blue-700">{{ .Error }}</p>
            </div>
          </div>
        </div>
        {{ end }}
        
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="hideForm()" class="admin-btn inline-flex items-center rounded-md bg-white text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Отмена
          </button>
          <button type="submit" class="admin-btn inline-flex items-center rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Create
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{{ end }}

{{ define "admin_color_type_form_container" }}
<div id="form-container" class="mb-6" style="display: none;">
  <div class="bg-white shadow sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-base font-semibold leading-6 text-gray-900">Create new color type</h3>
    </div>
    <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
      <form method="post" class="space-y-4">
        {{ template "admin_color_type_form_fields" . }}
        
        {{ if .Errors }}
        <div class="rounded-md bg-red-50 p-4">
          <div class="flex">
            <div class="ml-3 flex-1 md:flex md:justify-between">
              <ul class="text-sm text-red-700">
                {{ range .Errors }}
                <li><b>{{ .Field }}</b> {{ .Message }}</li>
                {{ end }}
              </ul>
            </div>
          </div>
        </div>
        {{ end }}
        
        {{ if .Error }}
        <div class="rounded-md bg-blue-50 p-4">
          <div class="flex">
            <div class="ml-3 flex-1 md:flex md:justify-between">
              <p class="text-sm text-blue-700">{{ .Error }}</p>
            </div>
          </div>
        </div>
        {{ end }}
        
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="hideForm()" class="admin-btn inline-flex items-center rounded-md bg-white text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Отмена
          </button>
          <button type="submit" class="admin-btn inline-flex items-center rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Create
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{{ end }}

{{ define "admin_user_form_container" }}
<div id="form-container" class="mb-6" style="display: none;">
  <div class="bg-white shadow sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-base font-semibold leading-6 text-gray-900">Create new user</h3>
    </div>
    <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
      <form method="post" class="space-y-4">
        {{ template "admin_user_form_fields" . }}
        
        {{ if .Errors }}
        <div class="rounded-md bg-red-50 p-4">
          <div class="flex">
            <div class="ml-3 flex-1 md:flex md:justify-between">
              <ul class="text-sm text-red-700">
                {{ range .Errors }}
                <li><b>{{ .Field }}</b> {{ .Message }}</li>
                {{ end }}
              </ul>
            </div>
          </div>
        </div>
        {{ end }}
        
        {{ if .Error }}
        <div class="rounded-md bg-blue-50 p-4">
          <div class="flex">
            <div class="ml-3 flex-1 md:flex md:justify-between">
              <p class="text-sm text-blue-700">{{ .Error }}</p>
            </div>
          </div>
        </div>
        {{ end }}
        
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="hideForm()" class="admin-btn inline-flex items-center rounded-md bg-white text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Отмена
          </button>
          <button type="submit" class="admin-btn inline-flex items-center rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
            Create
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{{ end }}

{{ define "admin_color_form_fields" }}
<div>
  <label for="slug-source" class="block text-sm font-medium text-gray-700">Name</label>
  <input type="text" name="name" id="slug-source" minlength="2" required value="{{ .Form.Name }}"
    class="admin-input mt-1 block w-full"
    placeholder="name">
</div>
<div>
  <label for="slug-target" class="block text-sm font-medium text-gray-700">Slug</label>
  <input type="text" name="slug" id="slug-target" value="{{ .Form.Slug }}" disabled
    class="admin-input mt-1 block w-full bg-gray-50"
    placeholder="slug">
</div>
<div>
  <label for="color_type" class="block text-sm font-medium text-gray-700">Color Type</label>
  <select name="color_type" id="color_type" required class="admin-input mt-1 block w-full">
    <option value="">Select color type</option>
    {{ $ct := .Form.ColorType }}
    {{ range .ColorTypes }}
      <option value="{{ .Slug }}" {{ if eq .Slug $ct }}selected{{ end }}>{{ .Name }}</option>
    {{ end }}
  </select>
</div>
{{ end }}

{{ define "admin_color_type_form_fields" }}
<div>
  <label for="slug-source" class="block text-sm font-medium text-gray-700">Name</label>
  <input type="text" name="name" id="slug-source" minlength="2" required value="{{ .Form.Name }}"
    class="admin-input mt-1 block w-full"
    placeholder="name">
</div>
<div>
  <label for="slug-target" class="block text-sm font-medium text-gray-700">Slug</label>
  <input type="text" name="slug" id="slug-target" value="{{ .Form.Slug }}"
    class="admin-input mt-1 block w-full"
    placeholder="slug">
</div>
{{ end }}

{{ define "admin_user_form_fields" }}
<div>
  <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
  <input type="text" name="username" id="username" minlength="2" required value="{{ .Form.Username }}"
    class="admin-input mt-1 block w-full"
    placeholder="username">
</div>
<div>
  <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
  <input type="password" name="password" id="password" minlength="5" required
    class="admin-input mt-1 block w-full"
    placeholder="password">
</div>
<div>
  <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
  <input type="email" name="email" id="email" value="{{ .Form.Email }}"
    class="admin-input mt-1 block w-full"
    placeholder="email">
</div>
<div class="grid grid-cols-2 gap-4">
  <div>
    <label for="first_name" class="block text-sm font-medium text-gray-700">First Name</label>
    <input type="text" name="first_name" id="first_name" value="{{ .Form.FirstName }}"
      class="admin-input mt-1 block w-full"
      placeholder="first name">
  </div>
  <div>
    <label for="last_name" class="block text-sm font-medium text-gray-700">Last Name</label>
    <input type="text" name="last_name" id="last_name" value="{{ .Form.LastName }}"
      class="admin-input mt-1 block w-full"
      placeholder="last name">
  </div>
</div>
<div class="flex items-center space-x-4">
  <div class="flex items-center">
    <input type="checkbox" name="is_superuser" id="is_superuser" {{ if .Form.IsSuperuser }}checked{{ end }}
      class="admin-checkbox border-gray-300 text-indigo-600 focus:ring-indigo-500">
    <label for="is_superuser" class="ml-2 block text-sm text-gray-900">Is Superuser</label>
  </div>
  <div class="flex items-center">
    <input type="checkbox" name="is_active" id="is_active" {{ if .Form.IsActive }}checked{{ end }}
      class="admin-checkbox border-gray-300 text-indigo-600 focus:ring-indigo-500">
    <label for="is_active" class="ml-2 block text-sm text-gray-900">Is Active</label>
  </div>
</div>
{{ end }}

{{ define "admin_add_button" }}
<button type="button" onclick="showForm()" class="admin-btn inline-flex items-center rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
  <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
    <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
  </svg>
  Добавить
</button>
{{ end }}

{{ define "admin_form_scripts" }}
<script>
console.log('Admin form scripts loaded');

function showForm() {
  console.log('showForm() called');
  const container = document.getElementById('form-container');
  const addButton = document.querySelector('button[onclick="showForm()"]');
  
  console.log('Container found:', container);
  console.log('Add button found:', addButton);
  
  if (container) {
    container.style.display = 'block';
    console.log('Form shown');
  }
  
  if (addButton) {
    addButton.style.setProperty('display', 'none', 'important');
    console.log('Add button hidden');
  } else {
    console.log('Add button not found!');
  }
}

function hideForm() {
  console.log('hideForm() called');
  const container = document.getElementById('form-container');
  const addButton = document.querySelector('button[onclick="showForm()"]');
  
  console.log('Container found:', container);
  console.log('Add button found:', addButton);
  
  if (container) {
    container.style.display = 'none';
    console.log('Form hidden');
  }
  
  if (addButton) {
    addButton.style.setProperty('display', 'inline-flex', 'important');
    console.log('Add button shown');
  } else {
    console.log('Add button not found!');
  }
}

// Auto-hide form on successful submission
document.addEventListener('htmx:afterRequest', function(evt) {
  console.log('HTMX afterRequest event:', evt.detail);
  if (evt.detail.successful && evt.detail.xhr.status === 200) {
    hideForm();
  }
});

// Test if functions are available globally
window.showForm = showForm;
window.hideForm = hideForm;
</script>
{{ end }} 